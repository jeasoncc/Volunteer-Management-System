# 📊 批量导入功能增强说明

## 🎯 更新内容

### 1. 新增支持的字段

批量导入现在支持**完整的义工信息字段**：

#### 基本信息
- ✅ 姓名（必填）
- ✅ 手机号（必填）
- ✅ 身份证号（必填）
- ✅ 性别
- ✅ 出生日期

#### 联系信息
- ✅ **深圳义工号** ⭐ **新增**
- ✅ 微信号 ⭐ **新增**
- ✅ 邮箱
- ✅ 地址

#### 详细信息
- ✅ 学历 ⭐ **新增**
- ✅ 宗教背景 ⭐ **新增**
- ✅ 皈依状态 ⭐ **新增**
- ✅ 健康状况 ⭐ **新增**
- ✅ 法名
- ✅ 紧急联系人
- ✅ 紧急联系电话 ⭐ **新增**

### 2. 新增 CSV 格式支持

现在支持两种文件格式：
- ✅ **Excel** (.xlsx, .xls)
- ✅ **CSV** (.csv) ⭐ **新增**

### 3. 智能字段映射

系统会自动识别和转换中文字段值：

#### 性别映射
```
男 → male
女 → female
其他 → other
```

#### 学历映射
```
小学 → elementary
初中 → middle_school
高中 → high_school
中专 → technical_secondary
专科 → associate
本科 → bachelor
硕士 → master
博士 → doctor
```

#### 宗教背景映射
```
佛教 → upasaka
无 → none
```

#### 皈依状态映射
```
皈依 → refuge
已皈依 → refuge
无 → none
未皈依 → none
```

#### 健康状况映射
```
很好 → healthy
无疾病 → healthy
健康 → healthy
一般 → general
较差 → poor
```

### 4. 增强的数据预览

预览表格现在显示更多重要字段：
- 姓名
- 手机号
- **深圳义工号** ⭐
- 性别
- **出生日期** ⭐
- 地址

## 📝 新模板格式

### Excel/CSV 模板包含以下列：

| 列名 | 是否必填 | 示例 | 说明 |
|------|---------|------|------|
| 姓名 | ✅ 必填 | 张三 | - |
| 手机号 | ✅ 必填 | 13800138000 | 11位数字 |
| 身份证号 | ✅ 必填 | 110101199001011234 | 18位 |
| 性别 | 选填 | 男 | 男/女/其他 |
| 出生日期 | 选填 | 1990-01-01 | YYYY-MM-DD格式 |
| 深圳义工号 | 选填 | 0000123456 | 唯一标识 |
| 微信号 | 选填 | zhangsan_wx | - |
| 邮箱 | 选填 | zhangsan@example.com | - |
| 地址 | 选填 | 北京市朝阳区某某街道 | - |
| 学历 | 选填 | 本科 | 见学历映射 |
| 宗教背景 | 选填 | 佛教 | 佛教/无 |
| 皈依状态 | 选填 | 皈依 | 皈依/无 |
| 健康状况 | 选填 | 很好 | 很好/一般/较差 |
| 法名 | 选填 | 释某某 | - |
| 紧急联系人 | 选填 | 李四 | - |
| 紧急联系电话 | 选填 | 13900139000 | - |

## 🚀 使用方法

### 方法1：使用 Excel 模板

1. **下载模板**
   - 在批量导入对话框中点击"下载 Excel 模板"
   - 会下载一个包含所有字段的模板文件

2. **填写数据**
   - 打开模板文件
   - 按照示例格式填写义工数据
   - 保存文件

3. **上传导入**
   - 点击上传区域选择文件
   - 预览数据确认无误
   - 点击"确认导入"

### 方法2：使用 CSV 文件

1. **准备 CSV 文件**
   - 第一行为列名（中文或英文）
   - 后续行为数据
   - 使用 UTF-8 编码保存

2. **上传导入**
   - 选择 CSV 文件上传
   - 系统会自动解析
   - 预览确认后导入

### 示例 CSV 格式

```csv
姓名,手机号,身份证号,性别,出生日期,深圳义工号,微信号,邮箱,地址,学历,宗教背景,皈依状态,健康状况
张三,13800138000,110101199001011234,男,1990-01-01,0000123456,zhangsan_wx,zhangsan@example.com,北京市朝阳区,本科,佛教,皈依,很好
李四,13900139000,110101199002021234,女,1990-02-02,0000123457,lisi_wx,lisi@example.com,北京市海淀区,硕士,无,无,很好
```

## ⚠️ 注意事项

### 必填字段
- ✅ 姓名
- ✅ 手机号
- ✅ 身份证号

### 唯一性检查
系统会自动检查以下字段的唯一性：
- 手机号
- 身份证号
- 深圳义工号（如果填写）

### 数据格式要求

1. **出生日期**
   - 格式：YYYY-MM-DD
   - 示例：1990-01-01

2. **手机号**
   - 11位数字
   - 示例：13800138000

3. **身份证号**
   - 18位
   - 示例：110101199001011234

4. **深圳义工号**
   - 通常10位数字
   - 示例：0000123456

### CSV 文件编码
- 必须使用 **UTF-8** 编码
- Excel 另存为 CSV 时选择"CSV UTF-8"格式

## 📊 导入流程

```
1. 下载模板
   ↓
2. 填写数据（Excel 或 CSV）
   ↓
3. 上传文件
   ↓
4. 系统解析并预览
   ↓
5. 确认数据无误
   ↓
6. 点击"确认导入"
   ↓
7. 系统批量创建义工
   ↓
8. 显示导入结果
```

## ✅ 修改的文件

- `apps/web/src/components/BatchImportDialog.tsx`

## 🎯 主要改进

### 修改前
- ❌ 只支持 9 个基本字段
- ❌ 缺少深圳义工号
- ❌ 缺少学历、宗教背景等重要字段
- ❌ 只支持 Excel 格式
- ❌ 预览只显示 4 列

### 修改后
- ✅ 支持 16 个完整字段
- ✅ 包含深圳义工号
- ✅ 包含学历、宗教背景、皈依状态等
- ✅ 支持 Excel 和 CSV 格式
- ✅ 预览显示 6 列重要信息
- ✅ 智能字段映射（中文自动转换）

## 🧪 测试建议

### 功能测试
1. **下载模板**
   - [ ] 点击"下载 Excel 模板"
   - [ ] 检查模板包含所有 16 个字段
   - [ ] 检查示例数据正确

2. **Excel 导入**
   - [ ] 填写完整数据
   - [ ] 上传 .xlsx 文件
   - [ ] 预览显示正确
   - [ ] 导入成功

3. **CSV 导入**
   - [ ] 准备 CSV 文件
   - [ ] 上传 .csv 文件
   - [ ] 预览显示正确
   - [ ] 导入成功

4. **字段映射**
   - [ ] 中文性别正确转换
   - [ ] 中文学历正确转换
   - [ ] 中文宗教背景正确转换
   - [ ] 中文皈依状态正确转换

5. **数据验证**
   - [ ] 必填字段验证
   - [ ] 唯一性检查
   - [ ] 格式验证

### 数据测试
使用提供的 `additional_5_volunteers.csv` 测试：
- [ ] 上传文件
- [ ] 预览显示 5 条数据
- [ ] 深圳义工号正确显示
- [ ] 导入成功

## 💡 使用技巧

### 1. 批量导入大量数据
- 建议每次不超过 100 条
- 可以分批导入

### 2. 更新现有义工
- 如果身份证号或手机号已存在
- 系统会提示重复
- 需要手动更新

### 3. 准备数据
- 先在 Excel 中整理好数据
- 检查格式正确
- 另存为 CSV UTF-8 格式
- 上传导入

### 4. 验证导入结果
- 导入后在义工列表中搜索
- 确认数据完整
- 检查深圳义工号等关键字段

## 📞 常见问题

**Q: CSV 文件乱码怎么办？**
A: 确保使用 UTF-8 编码保存。Excel 中选择"CSV UTF-8"格式。

**Q: 深圳义工号重复怎么办？**
A: 系统会提示重复，需要修改后重新导入。

**Q: 可以只填写部分字段吗？**
A: 可以。只有姓名、手机号、身份证号是必填的。

**Q: 学历填错了怎么办？**
A: 参考学历映射表，使用正确的中文名称。

**Q: 导入后可以修改吗？**
A: 可以。在义工列表中找到对应义工，点击编辑修改。

---

**更新时间：** 2025年11月26日  
**版本：** 2.0  
**新增字段：** 7个  
**新增格式：** CSV  
**状态：** ✅ 已完成