# 🙏 助念记录表功能说明

## 功能简介

在后端 document 模块添加了生成"深圳莲花关怀团助念记录表"的功能，可以通过前端表单填写信息后自动生成标准格式的 Excel 表格。

## 快速使用

### 前端使用（推荐）

1. 登录系统
2. 导航到 **文档管理** 页面
3. 点击 **"创建助念记录表"** 按钮
4. 填写表单（标记 * 的为必填项）
5. 点击 **"生成记录表"** 按钮
6. 系统自动生成并下载 Excel 文件

### API 调用

```bash
POST /api/document/care-record
Content-Type: application/json

{
  "name": "往生者姓名",
  "gender": "男",
  "age": 70,
  "address": "深圳市罗湖区",
  "reportDate": "2024-11-20 10:00",
  "hasInsurance": false,
  "hasFamily": true,
  "deathCondition": "安详",
  "mainFamily": {
    "name": "家属姓名",
    "phone": "13800138000",
    "relationship": "女"
  },
  "familyAddress": "深圳市罗湖区",
  ...
}
```

## 表格内容

生成的表格包含以下部分：

### 📋 基本信息
- 姓名、性别、年龄、学历
- 籍贯住址、职业/单位

### 📅 报损信息
- 会损时间、会损原因
- 是否准备心脏起搏器

### 🙏 助念信息
- 助念开始/结束时间、时长
- 家属情况

### 🕉️ 法名和受戒
- 法名、受戒情形
- 修行情形、平生信仰

### 💫 临终状态
- 临终状态（安详/疾苦）
- 家人意愿、念佛情况
- 入殓信息

### 📝 其他信息
- 兴趣爱好、个性习性
- 对待子女、做何善事
- 心愿未了、生平总结

### 👨‍👩‍👧‍👦 主事家属
- 姓名、电话、关系
- 家属现住址

## 表单字段

### 必填字段 ⭐
- 姓名
- 性别
- 年龄
- 籍贯住址
- 报损时间
- 临终状态
- 主事家属（姓名、电话、关系）
- 家属现住址

### 选填字段
- 学历、职业/单位
- 报损原因
- 助念时间、时长
- 法名、受戒情形
- 兴趣爱好、个性
- 心愿、生平总结
- 等等...

## 文件格式

- **格式**: Excel (.xlsx)
- **命名**: `助念记录表_姓名_时间戳.xlsx`
- **纸张**: A4 纵向
- **边框**: 所有单元格自动添加边框
- **标题**: 居中加粗，字号 18

## 技术实现

### 后端
- 使用 `exceljs` 库生成 Excel 文件
- 自动设置单元格格式、边框、对齐方式
- 支持单元格合并
- 文件保存在 `public` 目录

### 前端
- React 表单组件
- 使用 shadcn/ui 组件库
- 表单验证
- 自动下载生成的文件

## 示例数据

```typescript
{
  name: "柯景金",
  gender: "男",
  age: 69,
  address: "了东省深圳市罗湖区布心路",
  reportDate: "2025年11月17日12时30分",
  hasInsurance: false,
  hasFamily: true,
  familyCount: 1,
  deathCondition: "安详",
  hasFamily2: true,
  hasChanting: true,
  unfinishedWishes: "女三儿内对6时限",
  lifeSummary: "乐于助人 乐善好施",
  mainFamily: {
    name: "柯锦燕",
    phone: "13602504789",
    relationship: "女"
  },
  familyAddress: "了东省深圳市罗湖区布心路"
}
```

## 相关文件

### 后端
- `apps/api/src/modules/document/service.ts` - 生成逻辑
- `apps/api/src/modules/document/index.ts` - API 路由

### 前端
- `apps/web/src/services/document.ts` - API 调用
- `apps/web/src/components/CareRecordForm.tsx` - 表单组件
- `apps/web/src/routes/documents.tsx` - 文档管理页面

## 注意事项

1. ✅ 填写完整的必填信息
2. ✅ 日期格式建议使用标准格式
3. ✅ 电话号码格式正确
4. ✅ 生成后自动下载，请检查浏览器下载目录
5. ✅ 如需修改，重新填写表单生成即可

## 后续优化

- [ ] 支持保存草稿
- [ ] 支持模板管理
- [ ] 支持历史记录查询
- [ ] 支持批量生成
- [ ] 支持 PDF 导出
- [ ] 支持打印预览
- [ ] 从义工信息自动填充

---

**功能状态**: ✅ 已完成并可用
**更新时间**: 2024-11-20
