#+TITLE: 数据库表结构文档
#+AUTHOR: Your Name
#+DATE: [2023-08-17 四]

* 表结构定义

** 义工基础信息表 (volunteer)
|------------------------+--------------+------+------+-----------------------------+----------------------|
| 字段名                 | 类型         | 必填 | 唯一 | 默认值                      | 说明                 |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| 基础信息               |              |      |      |                             |                      |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| id                     | serial       | 是   | 是   | -                           | 系统自增主键ID       |
| lotus\_id              | varchar(50)  | 否   | 是   | -                           | 莲花斋内部义工编号   |
| volunteer\_id          | varchar(50)  | 否   | 是   | -                           | 深圳市义工联编号     |
| id\_number             | varchar(18)  | 是   | 是   | -                           | 身份证号码(18位)     |
| lotus\_role            | enum         | 否   | 否   | volunteer                   | 系统角色（见枚举表） |
| account                | varchar(50)  | 是   | 是   | -                           | 登录账号             |
| password               | varchar(255) | 是   | 否   | -                           | 加密后的密码         |
| name                   | varchar(50)  | 是   | 否   | -                           | 真实姓名             |
| gender                 | enum         | 是   | 否   | -                           | 性别（见枚举表）     |
| birth\_date            | date         | 否   | 否   | -                           | 出生日期             |
| birth\_date            | date         | 否   | 否   | -                           | 出生日期             |
| phone                  | varchar(20)  | 是   | 否   | -                           | 联系电话             |
| wechat                 | varchar(50)  | 否   | 否   | -                           | 微信账号             |
| email                  | varchar(100) | 否   | 否   | -                           | 电子邮箱             |
| address                | text         | 否   | 否   | -                           | 居住地址             |
| avatar                 | varchar(255) | 否   | 否   | -                           | 头像URL              |
| education              | enum         | 否   | 否   | high\_school                | 最高学历（见枚举表） |
| health\_conditions     | enum         | 否   | 否   | healthy                     | 健康状况（见枚举表） |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| 宗教信息               |              |      |      |                             |                      |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| has\_buddhism\_faith   | boolean      | 否   | 否   | false                       | 是否有佛教信仰       |
| refuge\_status         | enum         | 否   | 否   | none                        | 皈依状态（见枚举表） |
| religious\_background  | enum         | 否   | 否   | upasaka                     | 宗教背景（见枚举表） |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| 常住信息               |              |      |      |                             |                      |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| root\_id               | varchar(50)  | 是   | 是   | -                           | 房间号               |
| position               | varchar(50)  | 否   | 否   | -                           | 职位/身份            |
| seniority              | int          | 否   | 否   | -                           | 资历(年数)           |
| join\_date             | date         | 否   | 否   | -                           | 加入日期             |
| responsibilities       | json         | 否   | 否   | -                           | 职责(JSON数组)       |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| 系统统计信息           |              |      |      |                             |                      |
|------------------------+--------------+------+------+-----------------------------+----------------------|
| service\_hours         | int          | 否   | 否   | 0                           | 累计服务小时数       |
| is\_certified          | boolean      | 否   | 否   | false                       | 是否认证             |
| volunteer\_status      | enum         | 否   | 否   | applicant                   | 义工状态（见枚举表） |
| is\_active             | boolean      | 否   | 否   | true                        | 是否活跃             |
| last\_evaluation\_date | date         | 否   | 否   | -                           | 最后评估日期         |
| status                 | enum         | 否   | 否   | applicant                   | 状态（见枚举表）     |
| created\_at            | timestamp    | 否   | 否   | CURRENT_TIMESTAMP           | 创建时间             |
| updated\_at            | timestamp    | 否   | 否   | ON UPDATE CURRENT_TIMESTAMP | 最后更新时间         |
|------------------------+--------------+------+------+-----------------------------+----------------------|


** 管理员信息表 (admin)
|--------------+-------------+------+------+-----------------------------------------------+------------------|
| 字段名       | 类型        | 必填 | 唯一 | 默认值                                        | 说明             |
|--------------+-------------+------+------+-----------------------------------------------+------------------|
| id           | serial      | 是   | 是   | -                                             | 关联volunteer.id |
| role         | enum        | 是   | 否   | -                                             | 角色（见枚举表） |
| permissions  | json        | 否   | 否   | -                                             | 权限配置         |
| last\_login  | timestamp   | 否   | 否   | -                                             | 最后登录时间     |
| login\_ip    | varchar(50) | 否   | 否   | -                                             | 最后登录IP       |
| login\_count | int         | 否   | 否   | 0                                             | 登录次数         |
| is\_active   | boolean     | 否   | 否   | true                                          | 是否活跃         |
| department   | varchar(50) | 否   | 否   | -                                             | 所属部门         |
| updated\_at  | timestamp   | 是   | 否   | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 最后更新时间     |
|--------------+-------------+------+------+-----------------------------------------------+------------------|

** 义工签到表 (volunteer\_checkin)
|-------------+--------------+------+------+-----------------------------------------------+------------------|
| 字段名      | 类型         | 必填 | 唯一 | 默认值                                        | 说明             |
|-------------+--------------+------+------+-----------------------------------------------+------------------|
| id          | serial       | 是   | 是   | -                                             | 签到记录ID       |
| user\_id    | bigint       | 是   | 否   | -                                             | 关联volunteer.id |
| date        | date         | 是   | 否   | -                                             | 签到日期         |
| check\_in   | time         | 否   | 否   | -                                             | 签到时间         |
| check\_out  | time         | 否   | 否   | -                                             | 签退时间         |
| status      | enum         | 否   | 否   | present                                       | 状态（见枚举表） |
| location    | varchar(100) | 否   | 否   | -                                             | 签到地点         |
| device\_id  | varchar(50)  | 否   | 否   | -                                             | 签到设备ID       |
| notes       | text         | 否   | 否   | -                                             | 备注信息         |
| created\_at | timestamp    | 否   | 否   | CURRENT_TIMESTAMP                             | 记录创建时间     |
| updated\_at | timestamp    | 否   | 否   | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间     |
|-------------+--------------+------+------+-----------------------------------------------+------------------|

** 往生者表 (deceased)
|-----------------+-------------+------+------+-------------------+----------------------|
| 字段名          | 类型        | 必填 | 唯一 | 默认值            | 说明                 |
|-----------------+-------------+------+------+-------------------+----------------------|
| id              | serial      | 是   | 是   | -                 | 往生者唯一ID         |
| name            | varchar(50) | 是   | 否   | -                 | 往生者姓名           |
| chant\_number   | varchar(20) | 否   | 否   | -                 | 助念编号             |
| chant\_position | enum        | 否   | 否   | unknow            | 助念位置（见枚举表） |
| gender          | enum        | 是   | 否   | -                 | 性别（见枚举表）     |
| death\_date     | date        | 是   | 否   | -                 | 死亡日期             |
| death\_time     | time        | 否   | 否   | -                 | 舍报时间             |
| address         | text        | 是   | 否   | -                 | 生前住址             |
| created\_at     | timestamp   | 否   | 否   | CURRENT_TIMESTAMP | 创建时间             |
|-----------------+-------------+------+------+-------------------+----------------------|

** 助念排期表 (chanting\_schedule)
|--------------+-------------+------+------+-----------------------------------------------+----------------------|
| 字段名       | 类型        | 必填 | 唯一 | 默认值                                        | 说明                 |
|--------------+-------------+------+------+-----------------------------------------------+----------------------|
| id           | serial      | 是   | 是   | -                                             | 排期唯一ID           |
| location     | enum        | 否   | 否   | fuhuiyuan                                     | 助念地点（见枚举表） |
| date         | date        | 是   | 否   | -                                             | 排期日期             |
| time\_slot   | varchar(20) | 是   | 否   | -                                             | 时间段               |
| deceased\_id | bigint      | 是   | 否   | -                                             | 关联deceased.id      |
| status       | enum        | 否   | 否   | pending                                       | 状态（见枚举表）     |
| created\_at  | timestamp   | 否   | 否   | CURRENT_TIMESTAMP                             | 创建时间             |
| updated\_at  | timestamp   | 否   | 否   | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间             |
|--------------+-------------+------+------+-----------------------------------------------+----------------------|

* 枚举类型定义

*** 系统角色 (lotus\_role)
|-----------+--------------|
| 枚举值    | 说明         |
|-----------+--------------|
| admin     | 系统管理员   |
| volunteer | 普通义工     |
| resident  | 寺庙常住人员 |
|-----------+--------------|

*** 性别 (gender)
|--------+----------|
| 枚举值 | 说明     |
|--------+----------|
| male   | 男性     |
| female | 女性     |
| other  | 其他性别 |
|--------+----------|

*** 学历等级 (education)
|----------------+-----------|
| 枚举值         | 说明      |
|----------------+-----------|
| none           | 无学历    |
| elementary     | 小学      |
| middle\_school | 初中      |
| high\_school   | 高中/中专 |
| bachelor       | 本科      |
| master         | 硕士      |
| phd            | 博士      |
| other          | 其他      |
|----------------+-----------|

*** 皈依状态 (refuge\_status)
|----------------+----------|
| 枚举值         | 说明     |
|----------------+----------|
| none           | 未皈依   |
| took\_refuge   | 已皈依   |
| five\_precepts | 受五戒   |
| bodhisattva    | 受菩萨戒 |
|                |          |
|----------------+----------|

*** 健康状况 (health\_conditions)
|---------------------------+------------|
| 枚举值                    | 说明       |
|---------------------------+------------|
| healthy                   | 健康无异常 |
| has\_chronic\_disease     | 有慢性病   |
| has\_disability           | 有残疾     |
| has\_allergies            | 有过敏史   |
| recovering\_from\_illness | 病后恢复期 |
| other\_conditions         | 其他情况   |
|---------------------------+------------|

*** 宗教背景 (religious\_background)
|-------------------+----------------------|
| 枚举值            | 说明                 |
|-------------------+----------------------|
| upasaka           | 优婆塞（男居士）     |
| upasika           | 优婆夷（女居士）     |
| sramanera         | 沙弥（男）           |
| sramanerika       | 沙弥尼（女）         |
| bhikkhu           | 比丘                 |
| bhikkhuni         | 比丘尼               |
| anagarika         | 净人（预备出家）     |
| siladhara         | 持戒女（上座部体系） |
| novice\_monk      | 式叉摩那（学法女）   |
| buddhist\_visitor | 佛教文化爱好者       |
| none              | 无特定背景           |
|-------------------+----------------------|

*** 管理员角色 (admin.role)
|----------+------------|
| 枚举值   | 说明       |
|----------+------------|
| super    | 超级管理员 |
| admin    | 普通管理员 |
| operator | 操作员     |
|----------+------------|

*** 签到状态 (volunteer\_checkin.status)
|--------------+----------|
| 枚举值       | 说明     |
|--------------+----------|
| present      | 正常签到 |
| late         | 迟到     |
| early\_leave | 早退     |
| absent       | 缺席     |
| on\_leave    | 请假     |
|--------------+----------|

*** 助念位置 (deceased.chant\_position)
|------------+------------|
| 枚举值     | 说明       |
|------------+------------|
| room-one   | 一号助念室 |
| room-two   | 二号助念室 |
| room-three | 三号助念室 |
| room-four  | 四号助念室 |
| unknow     | 未知位置   |
|            |            |
|------------+------------|

*** 排期状态 (chanting\_schedule.status)
|--------------+--------|
| 枚举值       | 说明   |
|--------------+--------|
| pending      | 待确认 |
| confirmed    | 已确认 |
| in\_progress | 进行中 |
| completed    | 已完成 |
| cancelled    | 已取消 |
|--------------+--------|

* 表关系说明
1. volunteer 表与 resident 表通过 id 字段建立 1:1 关系
2. volunteer 表与 admin 表通过 id 字段建立 1:1 关系
3. volunteer 表与 volunteer\_checkin 表通过 id-user\_id 建立 1:N 关系
4. deceased 表与 chanting\_schedule 表通过 id-deceased\_id 建立 1:N 关系

* 索引说明
1. volunteer 表：
   - 主键：id
   - 唯一索引：lotus\_id, volunteer\_id, id\_number, account
2. resident 表：
   - 主键：id
   - 外键：id → volunteer.id
3. chanting\_schedule 表：
   - 组合索引：(date, time\_slot)
