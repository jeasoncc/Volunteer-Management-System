<!DOCTYPE html>
<html>
<head>
    <title>ç½‘ç»œé…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .info {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ ç½‘ç»œé…ç½®æµ‹è¯•</h1>
    
    <div class="info">
        <h3>å½“å‰æµè§ˆå™¨ä¿¡æ¯ï¼š</h3>
        <p>ä¸»æœºå: <strong id="hostname"></strong></p>
        <p>ç«¯å£: <strong id="port"></strong></p>
        <p>å®Œæ•´URL: <strong id="origin"></strong></p>
    </div>

    <div class="info">
        <h3>åç«¯APIä¿¡æ¯ï¼š</h3>
        <p>çŠ¶æ€: <strong id="api-status">æ£€æŸ¥ä¸­...</strong></p>
        <p>å±€åŸŸç½‘IP: <strong id="local-ip">-</strong></p>
        <p>å‰ç«¯åœ°å€: <strong id="frontend-url">-</strong></p>
        <p>åç«¯åœ°å€: <strong id="backend-url">-</strong></p>
    </div>

    <div class="info">
        <h3>æ‰‹æœºä¸Šä¼ é“¾æ¥æµ‹è¯•ï¼š</h3>
        <p>ç”Ÿæˆçš„é“¾æ¥: <strong id="mobile-url">-</strong></p>
        <p id="mobile-url-status"></p>
    </div>

    <button onclick="testConfig()">ğŸ”„ é‡æ–°æµ‹è¯•</button>
    <button onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>

    <script>
        // æ˜¾ç¤ºå½“å‰æµè§ˆå™¨ä¿¡æ¯
        document.getElementById('hostname').textContent = window.location.hostname;
        document.getElementById('port').textContent = window.location.port || '3000';
        document.getElementById('origin').textContent = window.location.origin;

        async function testConfig() {
            try {
                // æµ‹è¯•åç«¯API
                const response = await fetch('http://localhost:3001/api/system/network');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('api-status').textContent = 'âœ… æ­£å¸¸';
                    document.getElementById('api-status').parentElement.classList.add('success');
                    
                    document.getElementById('local-ip').textContent = data.data.localIP;
                    document.getElementById('frontend-url').textContent = data.data.config.frontend;
                    document.getElementById('backend-url').textContent = data.data.config.backend;
                    
                    // ç”Ÿæˆæ‰‹æœºä¸Šä¼ é“¾æ¥
                    const mobileUrl = `${data.data.config.frontend}/mobile-upload?token=test123`;
                    document.getElementById('mobile-url').textContent = mobileUrl;
                    
                    // æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®
                    if (mobileUrl.includes('localhost')) {
                        document.getElementById('mobile-url-status').innerHTML = 
                            '<span class="error">âŒ é”™è¯¯ï¼šé“¾æ¥åŒ…å«localhostï¼Œæ‰‹æœºæ— æ³•è®¿é—®ï¼</span>';
                    } else {
                        document.getElementById('mobile-url-status').innerHTML = 
                            '<span class="success">âœ… æ­£ç¡®ï¼šé“¾æ¥ä½¿ç”¨å±€åŸŸç½‘IPï¼Œæ‰‹æœºå¯ä»¥è®¿é—®</span>';
                    }
                    
                    // ç¼“å­˜IPåˆ°localStorage
                    localStorage.setItem('localIP', data.data.localIP);
                } else {
                    throw new Error('APIè¿”å›å¤±è´¥');
                }
            } catch (error) {
                document.getElementById('api-status').textContent = 'âŒ æ— æ³•è¿æ¥';
                document.getElementById('api-status').parentElement.classList.add('error');
                console.error('æµ‹è¯•å¤±è´¥:', error);
            }
        }

        function clearCache() {
            localStorage.removeItem('localIP');
            alert('ç¼“å­˜å·²æ¸…é™¤ï¼è¯·åˆ·æ–°é¡µé¢ã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        testConfig();
    </script>
</body>
</html>
