# åç«¯ API å®Œæ•´æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [è®¤è¯æ¨¡å—](#è®¤è¯æ¨¡å—) - `/api/auth`
2. [ä¹‰å·¥ç®¡ç†æ¨¡å—](#ä¹‰å·¥ç®¡ç†æ¨¡å—) - `/volunteer`
3. [è€ƒå‹¤ç®¡ç†æ¨¡å—](#è€ƒå‹¤ç®¡ç†æ¨¡å—) - `/api/v1`
4. [ç®¡ç†å‘˜æ¨¡å—](#ç®¡ç†å‘˜æ¨¡å—) - `/admin`
5. [æ–‡ä»¶ä¸Šä¼ æ¨¡å—](#æ–‡ä»¶ä¸Šä¼ æ¨¡å—) - `/api/upload`
6. [æ–‡æ¡£å¯¼å‡ºæ¨¡å—](#æ–‡æ¡£å¯¼å‡ºæ¨¡å—) - `/api/document`

---

## è®¤è¯æ¨¡å—

**å‰ç¼€**: `/api/auth`

### 1. ç”¨æˆ·æ³¨å†Œ
- **è·¯å¾„**: `POST /api/auth/register`
- **æƒé™**: å…¬å¼€
- **å‚æ•°**:
  ```typescript
  {
    account: string;    // è´¦å·
    password: string;   // å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
    name: string;       // å§“å
    phone: string;      // æ‰‹æœºå·
    gender: 'male' | 'female' | 'other';
    idNumber: string;   // èº«ä»½è¯å·
    email?: string;     // é‚®ç®±
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

### 2. ç”¨æˆ·ç™»å½•
- **è·¯å¾„**: `POST /api/auth/login`
- **æƒé™**: å…¬å¼€
- **å‚æ•°**:
  ```typescript
  {
    account: string;    // è´¦å·
    password: string;   // å¯†ç 
  }
  ```
- **è¿”å›**: ç”¨æˆ·ä¿¡æ¯ + JWT Tokenï¼ˆå­˜å‚¨åœ¨ Cookie ä¸­ï¼‰
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°

### 3. ç”¨æˆ·ç™»å‡º
- **è·¯å¾„**: `POST /api/auth/logout`
- **æƒé™**: éœ€è¦ç™»å½•
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°

### 4. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- **è·¯å¾„**: `GET /api/auth/me`
- **æƒé™**: éœ€è¦ç™»å½•
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°

---

## ä¹‰å·¥ç®¡ç†æ¨¡å—

**å‰ç¼€**: `/volunteer`
**æƒé™**: æ‰€æœ‰æ¥å£éœ€è¦ç™»å½•

### æ ¸å¿ƒ CRUD

#### 1. åˆ›å»ºä¹‰å·¥
- **è·¯å¾„**: `POST /volunteer`
- **å‚æ•°**: ä¹‰å·¥å®Œæ•´ä¿¡æ¯
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆè¡¨å•ï¼‰

#### 2. è·å–ä¹‰å·¥åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- **è·¯å¾„**: `GET /volunteer`
- **å‚æ•°**:
  ```typescript
  {
    page?: number;      // é¡µç 
    limit?: number;     // æ¯é¡µæ•°é‡
    keyword?: string;   // æœç´¢å…³é”®è¯
    status?: string;    // çŠ¶æ€ç­›é€‰
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°

#### 3. è·å–ä¹‰å·¥è¯¦æƒ…
- **è·¯å¾„**: `GET /volunteer/:lotusId`
- **å‰ç«¯çŠ¶æ€**: âš ï¸ éƒ¨åˆ†å®ç°ï¼ˆéœ€è¦è¯¦æƒ…é¡µï¼‰

#### 4. æ›´æ–°ä¹‰å·¥ä¿¡æ¯
- **è·¯å¾„**: `PUT /volunteer/:lotusId`
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆè¡¨å•ï¼‰

#### 5. åˆ é™¤ä¹‰å·¥
- **è·¯å¾„**: `DELETE /volunteer/:lotusId`
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°

### æ‰¹é‡æ“ä½œ

#### 6. æ‰¹é‡å¯¼å…¥ä¹‰å·¥
- **è·¯å¾„**: `POST /volunteer/batch/import`
- **å‚æ•°**:
  ```typescript
  {
    volunteers: Array<VolunteerData>;
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 7. æ‰¹é‡åˆ é™¤ä¹‰å·¥
- **è·¯å¾„**: `POST /volunteer/batch/delete`
- **å‚æ•°**:
  ```typescript
  {
    lotusIds: string[];
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

### å…¶ä»–åŠŸèƒ½

#### 8. æœç´¢ä¹‰å·¥
- **è·¯å¾„**: `GET /volunteer/search`
- **å‚æ•°**:
  ```typescript
  {
    keyword: string;
    limit?: number;
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆåœ¨åˆ—è¡¨ä¸­ï¼‰

#### 9. ä¿®æ”¹å¯†ç 
- **è·¯å¾„**: `POST /volunteer/:lotusId/change-password`
- **å‚æ•°**:
  ```typescript
  {
    oldPassword: string;
    newPassword: string;
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 10. å˜æ›´çŠ¶æ€
- **è·¯å¾„**: `PATCH /volunteer/:lotusId/status`
- **å‚æ•°**:
  ```typescript
  {
    status: 'applicant' | 'trainee' | 'registered' | 'inactive' | 'suspended';
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

---

## è€ƒå‹¤ç®¡ç†æ¨¡å—

**å‰ç¼€**: `/api/v1`

### è®¾å¤‡æ¥å£ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰

#### 1. é™Œç”Ÿäººè®°å½•
- **è·¯å¾„**: `POST /api/v1/stranger`
- **æƒé™**: è®¾å¤‡
- **å‰ç«¯çŠ¶æ€**: N/A

#### 2. äººè„¸è¯†åˆ«ç­¾åˆ°
- **è·¯å¾„**: `POST /api/v1/record/face`
- **æƒé™**: è®¾å¤‡
- **å‰ç«¯çŠ¶æ€**: N/A

### è€ƒå‹¤æ±‡æ€»

#### 3. æŸ¥è¯¢ç”¨æˆ·è€ƒå‹¤æ±‡æ€»
- **è·¯å¾„**: `GET /api/v1/summary/user`
- **å‚æ•°**:
  ```typescript
  {
    lotusId: string;
    startDate: string;  // YYYY-MM-DD
    endDate: string;    // YYYY-MM-DD
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 4. ç”Ÿæˆæœˆåº¦è€ƒå‹¤æ±‡æ€»
- **è·¯å¾„**: `POST /api/v1/summary/generate-monthly`
- **å‚æ•°**:
  ```typescript
  {
    year: number;
    month: number;
    force?: boolean;
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 5. ç”Ÿæˆæ¯æ—¥è€ƒå‹¤æ±‡æ€»
- **è·¯å¾„**: `POST /api/v1/summary/daily`
- **å‚æ•°**:
  ```typescript
  {
    date: string;  // YYYY-MM-DD
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 6. è·å–æœˆåº¦è€ƒå‹¤æŠ¥è¡¨
- **è·¯å¾„**: `GET /api/v1/report/monthly`
- **å‚æ•°**:
  ```typescript
  {
    year: number;
    month: number;
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°

### æ±‡æ€»è®°å½• CRUD

#### 7. æŸ¥è¯¢æ±‡æ€»è®°å½•åˆ—è¡¨
- **è·¯å¾„**: `GET /api/v1/summary/list`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 8. æ ¹æ® ID æŸ¥è¯¢æ±‡æ€»è®°å½•
- **è·¯å¾„**: `GET /api/v1/summary/:id`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 9. æ‰‹åŠ¨åˆ›å»ºæ±‡æ€»è®°å½•
- **è·¯å¾„**: `POST /api/v1/summary`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 10. æ›´æ–°æ±‡æ€»è®°å½•
- **è·¯å¾„**: `PUT /api/v1/summary/:id`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 11. åˆ é™¤æ±‡æ€»è®°å½•
- **è·¯å¾„**: `DELETE /api/v1/summary/:id`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 12. æ‰¹é‡åˆ é™¤æ±‡æ€»è®°å½•
- **è·¯å¾„**: `POST /api/v1/summary/batch-delete`
- **å‚æ•°**:
  ```typescript
  {
    ids: number[];
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 13. é‡æ–°è®¡ç®—æ±‡æ€»
- **è·¯å¾„**: `POST /api/v1/summary/recalculate`
- **å‚æ•°**:
  ```typescript
  {
    userId: number;
    date: string;
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

### å¯¼å‡ºåŠŸèƒ½

#### 14. å¯¼å‡ºå¿—æ„¿è€…æœåŠ¡æ—¶é—´ç»Ÿè®¡è¡¨ï¼ˆExcelï¼‰
- **è·¯å¾„**: `GET /api/v1/export/volunteer-service`
- **å‚æ•°**:
  ```typescript
  {
    startDate: string;      // YYYY-MM-DD
    endDate: string;        // YYYY-MM-DD
    lotusIds?: string;      // é€—å·åˆ†éš”çš„ lotusId
    activityName?: string;  // æ´»åŠ¨åç§°
  }
  ```
- **è¿”å›**: Excel æ–‡ä»¶
- **å‰ç«¯çŠ¶æ€**: âœ… å·²å®ç°

---

## ç®¡ç†å‘˜æ¨¡å—

**å‰ç¼€**: `/admin`
**æƒé™**: æ‰€æœ‰æ¥å£éœ€è¦ç™»å½•

#### 1. åˆ›å»ºç®¡ç†å‘˜
- **è·¯å¾„**: `POST /admin`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 2. è·å–ç®¡ç†å‘˜åˆ—è¡¨
- **è·¯å¾„**: `GET /admin`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 3. æ ¹æ® ID è·å–è¯¦æƒ…
- **è·¯å¾„**: `GET /admin/:id`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 4. æ›´æ–°ç®¡ç†å‘˜ä¿¡æ¯
- **è·¯å¾„**: `PUT /admin/:id`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 5. åˆ é™¤ç®¡ç†å‘˜
- **è·¯å¾„**: `DELETE /admin/:id`
- **å‚æ•°**:
  ```typescript
  {
    cascade?: boolean;  // æ˜¯å¦çº§è”åˆ é™¤
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 6. æ ¹æ® LotusID æŸ¥è¯¢
- **è·¯å¾„**: `GET /admin/search/lotus/:lotusId`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 7. æ ¹æ® LotusID æ›´æ–°
- **è·¯å¾„**: `PATCH /admin/by-lotus`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 8. å‡çº§å¿—æ„¿è€…ä¸ºç®¡ç†å‘˜
- **è·¯å¾„**: `POST /admin/promote`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 9. ä¿®æ”¹æƒé™
- **è·¯å¾„**: `PATCH /admin/permissions`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 10. æœç´¢ç®¡ç†å‘˜
- **è·¯å¾„**: `GET /admin/search`
- **å‚æ•°**:
  ```typescript
  {
    keyword: string;
    limit?: number;
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

---

## æ–‡ä»¶ä¸Šä¼ æ¨¡å—

**å‰ç¼€**: `/api/upload`

#### 1. å…¬å¼€å¤´åƒä¸Šä¼ ï¼ˆæ³¨å†Œç”¨ï¼‰
- **è·¯å¾„**: `POST /api/upload/avatar/public`
- **æƒé™**: å…¬å¼€
- **å‚æ•°**: FormData with file
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 2. ä¸Šä¼ å¤´åƒï¼ˆéœ€è¦ç™»å½•ï¼‰
- **è·¯å¾„**: `POST /api/upload/avatar`
- **æƒé™**: éœ€è¦ç™»å½•
- **å‚æ•°**:
  ```typescript
  {
    file: File;
    lotusId?: string;  // å¦‚æœæä¾›ï¼Œè‡ªåŠ¨å…³è”åˆ°ç”¨æˆ·
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

#### 3. æ‰¹é‡ä¸Šä¼ å¤´åƒ
- **è·¯å¾„**: `POST /api/upload/avatars/batch`
- **æƒé™**: éœ€è¦ç™»å½•
- **å‚æ•°**:
  ```typescript
  {
    files: File[];
  }
  ```
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

---

## æ–‡æ¡£å¯¼å‡ºæ¨¡å—

**å‰ç¼€**: `/api/document`

#### 1. åˆ›å»º Excel
- **è·¯å¾„**: `GET /api/document/excel`
- **å‰ç«¯çŠ¶æ€**: âŒ æœªå®ç°

---

## ğŸ“Š å‰ç«¯å®ç°çŠ¶æ€ç»Ÿè®¡

### å·²å®ç° âœ…
- è®¤è¯ï¼šç™»å½•ã€ç™»å‡ºã€è·å–ç”¨æˆ·ä¿¡æ¯
- ä¹‰å·¥ç®¡ç†ï¼šåˆ—è¡¨ã€åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€æœç´¢
- è€ƒå‹¤ç®¡ç†ï¼šæœˆåº¦æŠ¥è¡¨ã€Excel å¯¼å‡º

### éƒ¨åˆ†å®ç° âš ï¸
- ä¹‰å·¥è¯¦æƒ…é¡µé¢

### æœªå®ç° âŒ
- ç”¨æˆ·æ³¨å†Œé¡µé¢
- ä¹‰å·¥æ‰¹é‡å¯¼å…¥/åˆ é™¤
- ä¹‰å·¥å¯†ç ä¿®æ”¹
- ä¹‰å·¥çŠ¶æ€å˜æ›´
- è€ƒå‹¤è¯¦ç»†è®°å½•æŸ¥çœ‹
- è€ƒå‹¤æ±‡æ€»ç®¡ç†
- ç®¡ç†å‘˜ç®¡ç†æ¨¡å—
- æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- è®¾ç½®é¡µé¢

---

## ğŸ¯ å‰ç«¯å¼€å‘ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

1. **ä¹‰å·¥è¯¦æƒ…é¡µé¢**
   - è·¯ç”±ï¼š`/volunteers/:lotusId`
   - æ˜¾ç¤ºä¹‰å·¥å®Œæ•´ä¿¡æ¯
   - åŒ…å«ç¼–è¾‘ã€åˆ é™¤æŒ‰é’®

2. **æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½**
   - ä¹‰å·¥å¤´åƒä¸Šä¼ 
   - æ‹–æ‹½ä¸Šä¼ æ”¯æŒ
   - å›¾ç‰‡é¢„è§ˆ

3. **ä¹‰å·¥æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡åˆ é™¤ï¼ˆå‹¾é€‰ï¼‰
   - Excel æ‰¹é‡å¯¼å…¥

4. **è€ƒå‹¤è¯¦ç»†è®°å½•**
   - æŸ¥çœ‹æŸä¸ªä¹‰å·¥çš„è¯¦ç»†è€ƒå‹¤è®°å½•
   - æ—¥æœŸèŒƒå›´ç­›é€‰
   - æ‰“å¡æ—¶é—´æ˜¾ç¤º

### ä¸­ä¼˜å…ˆçº§ï¼ˆç®¡ç†åŠŸèƒ½ï¼‰

5. **ç®¡ç†å‘˜ç®¡ç†æ¨¡å—**
   - ç®¡ç†å‘˜åˆ—è¡¨
   - åˆ›å»º/ç¼–è¾‘ç®¡ç†å‘˜
   - æƒé™ç®¡ç†
   - å‡çº§ä¹‰å·¥ä¸ºç®¡ç†å‘˜

6. **ä¹‰å·¥çŠ¶æ€ç®¡ç†**
   - çŠ¶æ€å˜æ›´ï¼ˆç”³è¯·ä¸­â†’åŸ¹è®­ä¸­â†’å·²æ³¨å†Œï¼‰
   - çŠ¶æ€å†å²è®°å½•

7. **å¯†ç ç®¡ç†**
   - ä¿®æ”¹è‡ªå·±çš„å¯†ç 
   - é‡ç½®ä¹‰å·¥å¯†ç 

### ä½ä¼˜å…ˆçº§ï¼ˆè¾…åŠ©åŠŸèƒ½ï¼‰

8. **ç”¨æˆ·æ³¨å†Œé¡µé¢**
   - å…¬å¼€æ³¨å†Œå…¥å£
   - è¡¨å•éªŒè¯
   - å¤´åƒä¸Šä¼ 

9. **è®¾ç½®é¡µé¢**
   - ç³»ç»Ÿè®¾ç½®
   - ä¸ªäººè®¾ç½®
   - ä¸»é¢˜åˆ‡æ¢

10. **æ•°æ®ç»Ÿè®¡**
    - æ›´å¤šç»Ÿè®¡å›¾è¡¨
    - æ•°æ®å¯è§†åŒ–
    - è¶‹åŠ¿åˆ†æ

---

## ğŸ”— API åŸºç¡€åœ°å€

- **å¼€å‘ç¯å¢ƒ**: `http://localhost:3001`
- **ç”Ÿäº§ç¯å¢ƒ**: æ ¹æ®éƒ¨ç½²é…ç½®

## ğŸ” è®¤è¯æ–¹å¼

- ä½¿ç”¨ JWT Token
- Token å­˜å‚¨åœ¨ HTTP-only Cookie ä¸­
- Cookie åç§°ï¼š`auth`
- æœ‰æ•ˆæœŸï¼š7 å¤©

## ğŸ“ é€šç”¨å“åº”æ ¼å¼

```typescript
{
  success: boolean;
  message?: string;
  data?: any;
  code?: string;
}
```

## ğŸš¨ é”™è¯¯å¤„ç†

- 401: æœªç™»å½•
- 403: æƒé™ä¸è¶³
- 404: èµ„æºä¸å­˜åœ¨
- 400: å‚æ•°é”™è¯¯
- 500: æœåŠ¡å™¨é”™è¯¯
