# 同步日志筛选功能

## 功能说明

在同步进度面板中，可以点击统计卡片来筛选对应类型的日志。

## 使用方法

### 1. 点击统计卡片筛选

在同步进度面板中，有四个统计卡片：

| 卡片 | 点击效果 | 显示内容 |
|------|---------|---------|
| **已发送** (灰色) | 显示所有日志 | 包括成功、失败、跳过、信息等所有类型 |
| **成功** (绿色) | 只显示成功日志 | 只显示 ✅ 成功的记录 |
| **失败** (红色) | 只显示失败日志 | 只显示 ❌ 失败的记录（包含照片大小信息） |
| **跳过** (黄色) | 只显示跳过日志 | 只显示 ⏭️ 跳过的记录 |

### 2. 视觉反馈

- **悬停效果**：鼠标悬停时卡片颜色会加深
- **选中指示**：当前筛选的卡片底部会显示一条彩色横线
- **筛选提示**：日志标题会显示当前筛选状态

### 3. 取消筛选

点击以下任一方式可以取消筛选：
- 点击"已发送"卡片
- 点击日志标题右侧的"显示全部"按钮

## 使用场景

### 场景 1：快速查看失败原因

**操作：** 点击"失败"卡片（红色）

**效果：**
```
同步日志 (已筛选: 失败)                    [显示全部]

[15:47:17] ❌ 失败: 林相群 (LZ-V-2436418) - 没有找到照片 [原850.5KB->压缩320.8KB]
[15:47:18] ❌ 失败: 李广宇 (LZ-V-6635791) - 没有找到照片 [原280.3KB 未压缩]
[15:47:19] ❌ 失败: 陈璋 (LZ-V-3658028) - 人脸清晰度不符合标准 [原1850.5KB->压缩520.8KB]
```

**优势：**
- 只显示失败的记录
- 每条记录都包含照片大小信息
- 快速定位问题

### 场景 2：查看成功记录

**操作：** 点击"成功"卡片（绿色）

**效果：**
```
同步日志 (已筛选: 成功)                    [显示全部]

[15:47:16] ✅ 成功: 盐砖璋 (LZ-V-1579309)
[15:47:17] ✅ 成功: 杨菊玲 (LZ-V-7379100)
[15:47:18] ✅ 成功: 王永美 (LZ-V-4959805)
```

**优势：**
- 确认哪些义工同步成功
- 清晰的成功列表

### 场景 3：查看跳过记录

**操作：** 点击"跳过"卡片（黄色）

**效果：**
```
同步日志 (已筛选: 跳过)                    [显示全部]

[15:47:15] ⏭️ 跳过: 张三 (LZ-V-1234567) - 无头像
[15:47:16] ⏭️ 跳过: 李四 (LZ-V-2345678) - 照片无法访问
```

**优势：**
- 了解哪些义工被跳过
- 查看跳过原因

### 场景 4：查看所有日志

**操作：** 点击"已发送"卡片（灰色）或点击"显示全部"按钮

**效果：**
```
同步日志

[15:47:15] 开始同步，共 40 个义工 [批次: SYNC-20250107-154715-a1b2]
[15:47:16] 📸 盐砖璋: 原始照片 320.5KB
[15:47:16] 📦 盐砖璋: Base64 427.3KB
[15:47:16] 📤 发送: 盐砖璋 (LZ-V-1579309)
[15:47:16] ✅ 成功: 盐砖璋 (LZ-V-1579309)
[15:47:17] ❌ 失败: 林相群 (LZ-V-2436418) - 没有找到照片 [原850.5KB->压缩320.8KB]
```

**优势：**
- 查看完整的同步过程
- 了解每个步骤的详细信息

## 界面示例

### 未筛选状态（默认）

```
┌─────────────────────────────────────────────────────┐
│  已发送    │   成功    │   失败    │   跳过         │
│    40      │    32     │     8     │    14          │
│  ═══════   │           │           │                │
└─────────────────────────────────────────────────────┘

同步日志
┌─────────────────────────────────────────────────────┐
│ [15:47:15] 开始同步，共 40 个义工                    │
│ [15:47:16] ✅ 成功: 盐砖璋 (LZ-V-1579309)           │
│ [15:47:17] ❌ 失败: 林相群 - 没有找到照片 [原850KB] │
│ [15:47:18] ⏭️ 跳过: 张三 - 无头像                   │
└─────────────────────────────────────────────────────┘
```

### 筛选失败状态

```
┌─────────────────────────────────────────────────────┐
│  已发送    │   成功    │   失败    │   跳过         │
│    40      │    32     │     8     │    14          │
│            │           │  ═══════  │                │
└─────────────────────────────────────────────────────┘

同步日志 (已筛选: 失败)                    [显示全部]
┌─────────────────────────────────────────────────────┐
│ [15:47:17] ❌ 失败: 林相群 - 没有找到照片 [原850KB] │
│ [15:47:18] ❌ 失败: 李广宇 - 没有找到照片 [原280KB] │
│ [15:47:19] ❌ 失败: 陈璋 - 人脸清晰度不符 [原1850KB]│
└─────────────────────────────────────────────────────┘
```

## 交互细节

### 1. 卡片样式

- **默认状态**：淡色背景
- **悬停状态**：背景颜色加深
- **选中状态**：底部显示彩色横线
- **光标**：显示为手型（pointer）

### 2. 日志标题

- **未筛选**：只显示"同步日志"
- **已筛选**：显示"同步日志 (已筛选: XXX)"
- **显示全部按钮**：仅在筛选时显示

### 3. 空状态提示

如果筛选后没有对应类型的日志，会显示：
```
暂无失败日志
```

### 4. 自动滚动

- 新日志添加时自动滚动到底部
- 筛选切换时保持当前滚动位置

## 技术实现

### 状态管理

```typescript
const [logFilter, setLogFilter] = useState<"all" | "success" | "error" | "warning" | "info">("all")
```

### 筛选逻辑

```typescript
syncProgress.logs
  .filter((log: any) => logFilter === "all" || log.type === logFilter)
  .map((log: any, i: number) => (
    // 渲染日志
  ))
```

### 日志类型映射

| 日志类型 | 对应卡片 | 颜色 |
|---------|---------|------|
| `success` | 成功 | 绿色 |
| `error` | 失败 | 红色 |
| `warning` | 跳过 | 黄色 |
| `info` | 信息 | 灰色 |

## 优势

1. **快速定位** - 一键筛选特定类型的日志
2. **清晰直观** - 视觉反馈明确，操作简单
3. **提高效率** - 不需要在大量日志中查找
4. **易于排查** - 失败日志包含照片大小信息

## 使用建议

### 同步完成后的检查流程

1. **查看统计** - 先看整体数据（成功/失败/跳过数量）
2. **检查失败** - 点击"失败"卡片，查看失败原因和照片大小
3. **检查跳过** - 点击"跳过"卡片，了解哪些义工被跳过
4. **确认成功** - 点击"成功"卡片，确认成功列表
5. **查看全部** - 如需了解完整过程，点击"已发送"或"显示全部"

### 排查问题时

1. **先看失败** - 点击"失败"卡片
2. **分析照片大小** - 查看每条失败记录的照片信息
3. **判断原因** - 根据照片大小和错误信息判断失败原因
4. **采取措施** - 调整压缩参数或重新上传照片

## 完成状态

✅ 添加日志筛选状态
✅ 统计卡片可点击
✅ 显示选中指示器
✅ 筛选日志显示
✅ 显示全部按钮
✅ 空状态提示
✅ 悬停效果
✅ 代码通过类型检查

现在你可以点击统计卡片来筛选对应类型的日志了！
