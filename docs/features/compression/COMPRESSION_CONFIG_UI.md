# 压缩配置界面功能

## 功能说明

现在你可以直接在设备同步页面的界面上配置照片压缩参数，无需修改代码文件。

## 使用方法

### 1. 打开配置界面

在设备同步页面，当选择 "HTTP 地址" 照片格式时，会显示当前的压缩配置信息。点击右上角的 **"修改配置"** 按钮打开配置对话框。

### 2. 配置参数

配置对话框包含以下设置：

#### 基础配置

- **压缩阈值 (KB)**: 100-5000
  - 照片大小超过此值时触发压缩
  - 默认：800KB

- **目标大小 (KB)**: 50-2000
  - 压缩后的目标大小
  - 默认：500KB

#### 压缩策略

根据原始照片大小使用不同的压缩参数，每个策略包含：

- **最小大小 (KB)**: 触发此策略的最小照片大小
- **压缩质量 (%)**: 1-100，数值越高质量越好，文件越大
- **最大宽度 (px)**: 压缩后的最大宽度
- **描述**: 策略说明

默认策略：
1. 超大照片 (> 3200KB): 质量80%，宽度1024px
2. 大照片 (> 1600KB): 质量82%，宽度1280px
3. 中等照片 (> 800KB): 质量85%，宽度1280px

### 3. 保存配置

点击 **"保存配置"** 按钮，配置会立即生效，无需重启服务。

## 技术实现

### 前端

- `apps/web/src/components/CompressionConfigDialog.tsx` - 配置对话框组件
- `apps/web/src/routes/devices.tsx` - 添加配置按钮和对话框
- `apps/web/src/services/device.ts` - 添加更新配置的 API 调用

### 后端

- `apps/api/src/modules/ws/index.ts` - 添加 POST `/compression/config` 端点
- `apps/api/src/config/compression.ts` - 压缩配置文件（运行时可修改）

## 配置验证

- 压缩阈值：100-5000 KB
- 目标大小：50-2000 KB
- 压缩质量：1-100%
- 最大宽度：任意正整数

## 注意事项

1. 配置修改后立即生效，影响后续的照片压缩
2. 已压缩的照片不会重新处理
3. 配置保存在内存中，服务重启后会恢复默认值
4. 如需永久保存配置，可以修改 `apps/api/src/config/compression.ts` 文件

## 使用建议

- 如果照片经常同步失败，可以降低压缩阈值或提高压缩质量
- 如果网络较慢，可以降低目标大小和最大宽度
- 建议根据实际设备性能和网络情况调整参数
