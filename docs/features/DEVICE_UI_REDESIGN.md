# 设备与同步页面重新设计

## 设计理念

### 问题
- 原页面功能混杂在一起，不够清晰
- 操作流程不够直观
- 缺少广告和配置管理功能
- UI布局不够现代化

### 解决方案
采用**标签页（Tabs）**的方式组织功能，将不同的功能模块分离，让用户更容易找到需要的功能。

## 新的页面结构

```
设备与同步
├── 同步管理 (Sync Tab)
│   ├── 同步配置
│   │   ├── 同步策略（全量/增量/更新）
│   │   ├── 照片格式（URL/Base64）
│   │   └── 其他选项（预检查照片）
│   ├── 同步进度
│   │   ├── 进度条
│   │   ├── 统计数据
│   │   ├── 预估时间
│   │   └── 重试按钮
│   └── 同步日志
│
├── 设备管理 (Device Tab)
│   ├── 设备状态卡片
│   ├── 快速操作
│   │   ├── 刷新状态
│   │   └── 清空设备
│   └── 单个下发
│
├── 广告设置 (Advert Tab)
│   ├── 广告配置表单
│   │   ├── 广告ID
│   │   ├── 显示时长
│   │   └── 图片地址
│   └── 使用说明
│
└── 同步历史 (History Tab)
    ├── 批次列表
    └── 批次详情
        ├── 统计卡片
        └── 失败记录列表
```

## 主要改进

### 1. 标签页组织 ✨
- **同步管理**：专注于同步操作和进度监控
- **设备管理**：设备状态查看和基本操作
- **广告设置**：新增功能，设置设备广告
- **同步历史**：查看历史记录和失败详情

### 2. 视觉优化 🎨
- 使用卡片（Card）组织内容
- 统一的配色方案（成功=绿色，失败=红色，警告=黄色）
- 更大的字体和间距，提高可读性
- 图标和文字结合，更直观

### 3. 交互优化 🖱️
- 同步配置集中在一个区域
- 进度显示更清晰（百分比 + 进度条）
- 重试按钮只在有失败项时显示
- 历史记录支持点击查看详情

### 4. 功能增强 ⚡
- 添加广告设置功能
- 历史记录支持查看失败详情
- 预估完成时间显示
- 更好的错误处理和提示

## 组件结构

### SyncTab.tsx
**职责**：同步管理
- 同步配置（策略、格式、选项）
- 同步进度监控
- 同步日志显示
- 失败重试

**状态管理**：
- `syncStrategy`: 同步策略
- `photoFormat`: 照片格式
- `validatePhotos`: 是否预检查

### DeviceTab.tsx
**职责**：设备管理
- 设备状态显示
- 刷新设备状态
- 清空设备用户
- 单个义工下发

**特点**：
- 实时状态更新（每5秒）
- 危险操作需要确认

### AdvertTab.tsx
**职责**：广告设置
- 配置广告ID
- 设置显示时长
- 上传图片地址
- 使用说明

**新增功能**：
- 支持设置设备屏幕广告
- 表单验证
- 使用说明提示

### HistoryTab.tsx
**职责**：同步历史
- 批次列表展示
- 批次详情查看
- 失败记录分析

**特点**：
- 支持点击查看详情
- 失败记录高亮显示
- 统计数据可视化

## 使用流程

### 典型场景1：批量同步义工
1. 切换到"同步管理"标签
2. 选择同步策略（默认全量）
3. 选择照片格式（默认URL）
4. 点击"开始同步"
5. 查看实时进度和日志
6. 如有失败，点击重试按钮

### 典型场景2：查看设备状态
1. 切换到"设备管理"标签
2. 查看设备在线状态
3. 需要时点击"刷新设备状态"

### 典型场景3：设置广告
1. 切换到"广告设置"标签
2. 输入广告ID和时长
3. 输入图片地址
4. 点击"设置广告"

### 典型场景4：查看历史记录
1. 切换到"同步历史"标签
2. 浏览批次列表
3. 点击某个批次查看详情
4. 查看失败记录

## 技术实现

### 组件拆分
- 每个标签页独立组件
- 状态通过 props 传递
- 使用 React Query 管理数据

### 状态管理
- 同步进度：useState + sessionStorage
- 设备状态：React Query（自动刷新）
- 历史记录：React Query（按需加载）

### 样式系统
- Tailwind CSS
- shadcn/ui 组件库
- 响应式设计

## 后续优化方向

### 短期
- [ ] 添加访客二维码设置功能
- [ ] 支持图片上传（而非只输入URL）
- [ ] 添加同步统计图表

### 中期
- [ ] 支持批量操作（选择多个批次）
- [ ] 导出同步报告
- [ ] 添加通知功能

### 长期
- [ ] 实时WebSocket推送
- [ ] 移动端适配
- [ ] 多语言支持

## 迁移说明

### 文件变更
- `apps/web/src/routes/devices.tsx` - 主页面（已重构）
- `apps/web/src/routes/devices.old.tsx` - 旧版本备份
- `apps/web/src/components/device/` - 新增组件目录
  - `SyncTab.tsx` - 同步管理
  - `DeviceTab.tsx` - 设备管理
  - `AdvertTab.tsx` - 广告设置
  - `HistoryTab.tsx` - 同步历史

### 兼容性
- 所有原有功能保留
- API接口无变化
- 数据结构无变化

### 回滚方案
如需回滚到旧版本：
```bash
cd apps/web/src/routes
mv devices.tsx devices.new.tsx
mv devices.old.tsx devices.tsx
```

## 总结

新的设计更加**清晰**、**直观**、**易用**，通过标签页的方式将不同功能分离，让用户能够快速找到需要的功能。同时保留了所有原有功能，并新增了广告设置等实用功能。
